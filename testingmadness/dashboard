<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vertex - Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --color-primary: #A61B1B;
            --color-bg: #121212;
            --color-card: #1E1E1E;
            --color-text: #FFFFFF;
            --color-subtle: #999999;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }

        .container { width: 100%; max-width: 600px; padding: 20px; }

        /* --- STATES --- */
        #api-input-state, #loading-state, #success-state, #command-center-state { display: none; }

        #server-list-state { text-align: center; }
        .server-grid { display: grid; gap: 15px; margin-top: 30px; }
        
        .server-card {
            background: var(--color-card);
            padding: 20px;
            border-radius: 12px;
            cursor: pointer;
            border: 1px solid #333;
            transition: 0.3s;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .server-card:hover { border-color: var(--color-primary); transform: translateY(-3px); background: #252525; }
        
        .server-icon {
            width: 50px; height: 50px;
            background: var(--color-primary);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center; font-weight: bold;
        }

        /* --- API INPUT --- */
        #api-input-state { background: var(--color-card); padding: 40px; border-radius: 15px; border-top: 4px solid var(--color-primary); }
        .input-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-size: 0.9em; color: var(--color-subtle); }
        input {
            width: 100%; padding: 12px;
            background: #121212; border: 1px solid #444;
            border-radius: 6px; color: white; outline: none; box-sizing: border-box;
        }
        input:focus { border-color: var(--color-primary); }
        
        .btn {
            width: 100%; padding: 12px;
            background: var(--color-primary); border: none;
            color: white; font-weight: 700; border-radius: 6px;
            cursor: pointer; transition: 0.3s;
        }
        .btn:hover { background: #8C1616; }
        .btn:disabled { background: #444; cursor: not-allowed; }

        /* --- COMMAND CENTER --- */
        #command-center-state { text-align: center; background: var(--color-card); padding: 40px; border-radius: 15px; border-top: 4px solid var(--color-primary); }
        #api-status { margin-top: 15px; font-size: 0.85em; }

        /* --- LOADING & SUCCESS --- */
        #loading-state { text-align: center; }
        .spinner {
            width: 60px; height: 60px;
            border: 5px solid rgba(255,255,255,0.1);
            border-top: 5px solid var(--color-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        #success-state { text-align: center; }
        .checkmark-svg { width: 80px; height: 80px; margin-bottom: 20px; }
        .checkmark-circle { stroke-dasharray: 166; stroke-dashoffset: 166; stroke-width: 2; stroke-miterlimit: 10; stroke: var(--color-primary); fill: none; animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards; }
        .checkmark-check { transform-origin: 50% 50%; stroke-dasharray: 48; stroke-dashoffset: 48; stroke: var(--color-primary); stroke-width: 3; fill: none; animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards; }

        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes stroke { 100% { stroke-dashoffset: 0; } }
    </style>
</head>
<body>

    <div class="container">
        
        <div id="server-list-state">
            <h1 style="color: var(--color-primary);">Select a Server</h1>
            <p style="color: var(--color-subtle);">Choose a community to manage.</p>
            <div class="server-grid">
                <div class="server-card" onclick="goToInput('Oxford Response RP')">
                    <div class="server-icon">OR</div>
                    <div><div style="font-weight: 600;">Oxford Response RP</div><div style="font-size: 0.8em; color: var(--color-subtle);">Owner</div></div>
                </div>
            </div>
        </div>

        <div id="api-input-state">
            <h2 id="selected-server-name" style="margin-bottom: 5px;">Server Setup</h2>
            <p style="font-size: 0.8em; color: var(--color-subtle); margin-bottom: 25px;">Connect your Vertex API key to proceed.</p>
            <div class="input-group">
                <label>Server ID</label>
                <input type="text" id="serverId" placeholder="e.g. 1029384756352">
            </div>
            <div class="input-group">
                <label>API Key</label>
                <input type="password" id="apiKey" placeholder="VTX_xxxxxxxxxxxxxxxx">
            </div>
            <button class="btn" onclick="startLoading()">Connect Server</button>
        </div>

        <div id="loading-state">
            <div class="spinner"></div>
            <h3>Verifying Connection</h3>
        </div>

        <div id="success-state">
            <svg class="checkmark-svg" viewBox="0 0 52 52">
                <circle class="checkmark-circle" cx="26" cy="26" r="25" fill="none"/>
                <path class="checkmark-check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
            </svg>
            <h2>Connected!</h2>
            <button class="btn" onclick="goToCommandCenter()" style="margin-top: 20px;">Open Command Console</button>
        </div>

        <div id="command-center-state">
            <h2 style="color: var(--color-primary); margin-bottom: 10px;">Command Console</h2>
            <p style="color: var(--color-subtle); font-size: 0.9em; margin-bottom: 30px;">Direct API link to <span id="display-id"></span></p>
            
            <div class="input-group">
                <input type="text" id="cmdInput" placeholder="Enter command (e.g. /kick user)">
            </div>
            <button class="btn" id="execBtn" onclick="executeCommand()">Execute Command</button>
            
            <div id="api-status"></div>
        </div>

    </div>

    <script>
        let savedId = "";
        let savedKey = "";

        // Navigation
        function goToInput(name) {
            document.getElementById('server-list-state').style.display = 'none';
            document.getElementById('api-input-state').style.display = 'block';
            document.getElementById('selected-server-name').innerText = name;
        }

        function startLoading() {
            savedId = document.getElementById('serverId').value;
            savedKey = document.getElementById('apiKey').value;

            if(!savedId || !savedKey) {
                alert("Please fill in both fields!");
                return;
            }

            document.getElementById('api-input-state').style.display = 'none';
            document.getElementById('loading-state').style.display = 'block';

            setTimeout(() => {
                document.getElementById('loading-state').style.display = 'none';
                document.getElementById('success-state').style.display = 'block';
            }, 2000);
        }

        function goToCommandCenter() {
            document.getElementById('success-state').style.display = 'none';
            document.getElementById('command-center-state').style.display = 'block';
            document.getElementById('display-id').innerText = "ID: " + savedId;
        }

        // --- ACTUAL API SCRIPTING ---
        async function executeCommand() {
            const cmd = document.getElementById('cmdInput').value;
            const statusDiv = document.getElementById('api-status');
            const btn = document.getElementById('execBtn');

            if(!cmd) return;

            // UI Feedback
            statusDiv.innerHTML = "Sending request...";
            statusDiv.style.color = "var(--color-subtle)";
            btn.disabled = true;

            try {
                const response = await fetch('https://api.oxfd.re/v1/server/command', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'server-key': savedKey,
                        'server-id': savedId
                    },
                    body: JSON.stringify({
                        command: cmd
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    statusDiv.innerHTML = "✅ Command Executed Successfully";
                    statusDiv.style.color = "#4CAF50";
                } else {
                    statusDiv.innerHTML = "❌ Error: " + (data.message || "Failed to execute");
                    statusDiv.style.color = "#ff4d4d";
                }
            } catch (error) {
                statusDiv.innerHTML = "❌ Network Error: Could not reach API";
                statusDiv.style.color = "#ff4d4d";
            } finally {
                btn.disabled = false;
                document.getElementById('cmdInput').value = ""; // Clear box
            }
        }
    </script>

</body>
</html>
